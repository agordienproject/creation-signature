<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <title>Générateur de Signature</title>
</head>
<body>

<div class="container mt-5">
  <form onsubmit="generateSignature(event)">
    <div class="mb-3">
      <label for="nom" class="form-label">Nom (en majuscules uniquement)</label>
      <input type="text" class="form-control" id="nom" name="nom" oninput="this.value = this.value.toUpperCase()">
    </div>
    <div class="mb-3">
      <label for="prenom" class="form-label">Prénom</label>
      <input type="text" class="form-control" id="prenom" name="prenom">
    </div>
    <div class="mb-3">
      <label for="promotion" class="form-label">Promotion (nom promotion + année)</label>
      <input type="text" class="form-control" id="promotion" name="promotion" placeholder="ex : FISA INFO A3">
    </div>
    <div class="mb-3">
      <label for="email" class="form-label">Adresse e-mail</label>
      <input type="email" class="form-control" id="email" name="email">
    </div>
    <div class="mb-3">
      <label for="image" class="form-label">Choisissez une image</label>
      <input type="file" class="form-control" id="image" name="image" accept="image/*">
    </div>
    <button type="submit" class="btn btn-primary">Générer Signature</button>
  </form>

  <hr class="my-4">

  <div id="preview-container" class="mt-3"></div>

  <button onclick="downloadSignature()" class="btn btn-secondary mt-3">Télécharger Signature</button>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
  function generateSignature(event) {
    event.preventDefault();

    // Récupérer les valeurs du formulaire
    const nom = document.getElementById('nom').value;
    const prenom = document.getElementById('prenom').value;
    const promotion = document.getElementById('promotion').value;
    const email = document.getElementById('email').value;
    const imageInput = document.getElementById('image');

    // Créer un canevas
    const canvas = document.createElement('canvas');
    canvas.width = 800;
    canvas.height = 200;
    const ctx = canvas.getContext('2d');

    // Dessiner un fond blanc
    ctx.fillStyle = 'white';
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    const imgWidth = 270;
    const imgHeight = 130;

    if (imageInput.files && imageInput.files[0]) {
      const reader = new FileReader();
      reader.onload = function(e) {
        const img = new Image();
        img.onload = function() {
          // Redimensionner l'image à 700 par 300
          ctx.drawImage(img, 0, 35, imgWidth, imgHeight);

          // Dessiner une ligne bleue verticale
          ctx.beginPath();
          ctx.moveTo(canvas.width * 0.35, 35);
          ctx.lineTo(canvas.width * 0.35, 165);
          ctx.strokeStyle = 'blue';
          ctx.stroke();

          // Dessiner le texte à droite
          ctx.font = 'bold 16px Arial';
          ctx.fillStyle = 'black';
          ctx.textAlign = 'left';
          ctx.fillText(`${prenom} ${nom}`, canvas.width * 0.35 + 10, 55);
          ctx.font = '14px courier';
          ctx.fillText(`${promotion}`, canvas.width * 0.35 + 10, 75);
          ctx.font = 'bold 16px Arial';
          ctx.fillText(`${email}`, canvas.width * 0.35 + 10, 105);
          ctx.fillText('16 rue Magellan', canvas.width * 0.35 + 10, 140);
          ctx.fillText('31670, Labège', canvas.width * 0.35 + 10, 160);

          // Afficher l'aperçu
          const previewContainer = document.getElementById('preview-container');
          previewContainer.innerHTML = '';
          previewContainer.appendChild(canvas);
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(imageInput.files[0]);
    }


  }

  function downloadSignature() {
    // Récupérer le canevas de l'aperçu
    const canvas = document.querySelector('#preview-container canvas');

    // Créer un lien pour le téléchargement
    const link = document.createElement('a');
    link.href = canvas.toDataURL('image/png');
    link.download = 'signature.png';
    link.click();
  }
</script>

</body>
</html>
